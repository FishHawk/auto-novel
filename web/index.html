<!DOCTYPE html>
<html lang="zh">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QD8MZ90XFJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'G-QD8MZ90XFJ');
    </script>
    <script>
      window.onerror = function (msg, url, lno, cno) {
        if (window.location.href.replace(window.origin, '') === '/') {
          var div = document.createElement('div');
          div.innerHTML = `JS错误: ${lno}:${cno} ${msg
            .replace('<', '&lt;')
            .replace('>', '&gt;')} ${url}`;
          document.body.appendChild(div);
        }
        return false;
      };
    </script>
    <meta charset="UTF-8" />
    <meta name="keywords" content="轻小说,日本轻小说,成为小说家,机翻,翻译" />
    <meta
      name="description"
      content="轻小说机翻机器人使用百度/有道批量翻译日文轻小说，支持成为小说家、Kakuyomu等网站。"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <link rel="icon" type="image/svg+xml" href="/robot.svg" />
    <title>轻小说机翻机器人</title>
    <script>
      (() => {
        function createBodyStyle(color, backgroundColor) {
          const style = document.createElement('style');
          style.innerHTML = `body {
            background-color: ${backgroundColor};
            color: ${color};
          }`;
          document.head.appendChild(style);
        }
        function createWebDarkTheme() {
          createBodyStyle('rgba(255, 255, 255, 0.82)', 'rgb(16, 16, 20)');
        }

        const reg = [/\/novel\/(\w+)\/(\w+)\/(\w+)/, /\/workspace\/reader\/(\w+)\/(\w+)/];
        const isReader = reg.some((r) => r.test(window.location.pathname));

        if (isReader) {
          const setting = localStorage.getItem('readerSetting');
          const theme = setting ? JSON.parse(setting).theme : null;
          if (!theme) return;

          if (theme.mode === 'dark') {
            createWebDarkTheme();
          } else if (
            theme.mode === 'system' &&
            window.matchMedia('(prefers-color-scheme: dark)').matches
          ) {
            createWebDarkTheme();
          } else if (theme.mode === 'custom') {
            createBodyStyle(theme.fontColor, theme.bodyColor);
          }
        } else {
          const setting = localStorage.getItem('setting');
          const theme = setting ? JSON.parse(setting).theme : 'light';
          if (theme === 'dark') {
            createWebDarkTheme();
          } else if (
            theme === 'system' &&
            window.matchMedia('(prefers-color-scheme: dark)').matches
          ) {
            createWebDarkTheme();
          }
        }
      })();
    </script>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
    <noscript>
      <p>本页面需要浏览器启用JavaScript。</p>
      <p>如果已经启用，那...朋友，你该更新浏览器了。</p>
    </noscript>
  </body>
</html>
